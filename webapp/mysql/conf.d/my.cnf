# 高性能MySQL設定 - ベンチマーク最適化
[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
lower_case_table_names=1
secure_file_priv="/docker-entrypoint-initdb.d/csv"

# === InnoDB最適化 ===
# バッファプールサイズ（利用可能メモリの70-80%）
innodb_buffer_pool_size = 1G
innodb_buffer_pool_instances = 4
innodb_buffer_pool_chunk_size = 128M

# ログファイル設定（高速書き込み）
# innodb_log_file_size は MySQL 8.0.30+ では廃止済み
innodb_redo_log_capacity = 512M  # MySQL 8.0.30+ の新しい設定
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 2  # 性能重視（durability < performance）

# I/O最適化
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000
innodb_read_io_threads = 8
innodb_write_io_threads = 8
innodb_flush_method = O_DIRECT

# その他InnoDB最適化
innodb_adaptive_hash_index = ON
innodb_change_buffering = all
innodb_old_blocks_time = 1000

# === クエリキャッシュ無効化（MySQL 8.0では廃止済み） ===
# query_cache_type = 0
# query_cache_size = 0

# === 接続・メモリ最適化 ===
max_connections = 300  # ベンチマーク用に適正化
max_allowed_packet = 1G
thread_cache_size = 50
table_open_cache = 4000
table_definition_cache = 2000

# === テンポラリテーブル最適化 ===
tmp_table_size = 128M
max_heap_table_size = 128M

# === ソート・グループ化最適化 ===
sort_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 8M
join_buffer_size = 8M

# === 全文検索最適化 ===
ngram_token_size = 2
ft_min_word_len = 2

# === ログ無効化（性能重視） ===
disable-log-bin
slow_query_log = OFF
general_log = OFF

# === パフォーマンススキーマ最適化 ===
performance_schema = ON
performance_schema_max_table_instances = 12500
performance_schema_max_table_handles = 4000

[mysqldump]
max_allowed_packet = 2G

[client]
default-character-set = utf8mb4

